<article
  [ngClass]="{
    'sat-structureSetTargetPanel': true,
    'sat-structureSetTargetPanel--distributeAvailableState': (state.activeMetric === constants.metric.cs01 && state.displayPercentageUnallocatedCS01 !== 0) || (state.activeMetric === constants.metric.creditLeverage && state.displayPercentageUnallocatedCreditLeverage !== 0),
    'sat-structureSetTargetPanel--cs01ActiveState': state.activeMetric === constants.metric.cs01,
    'sat-structureSetTargetPanel--creditLeverageActiveState': state.activeMetric === constants.metric.creditLeverage,
    'sat-structureSetTargetPanel--editingOverrideState': state.targetBreakdownIsOverride,
    'sat-structureSetTargetPanel--displayConfiguratorState': state.configurator.display,
    'sat-structureSetTargetPanel--bicsBreakdownVariant': state.targetBreakdown?.state.isBICs,
    'sat-structureSetTargetPanel--ratingAvailableState': state.targetBreakdown?.state.isTargetAlignmentRatingAvail && state.targetBreakdown?.state.isBICs,
    'sat-structureSetTargetPanel--goodRating': state.targetBreakdown?.state.isTargetAlignmentRatingAvail && state.targetBreakdown?.style.ratingFillWidth >= 80 &&state.targetBreakdown?.state.isBICs,
    'sat-structureSetTargetPanel--averageRating': state.targetBreakdown?.state.isTargetAlignmentRatingAvail && state.targetBreakdown?.style.ratingFillWidth >= 60 && state.targetBreakdown?.style.ratingFillWidth < 80 && state.targetBreakdown?.state.isBICs,
    'sat-structureSetTargetPanel--badRating': state.targetBreakdown?.state.isTargetAlignmentRatingAvail && state.targetBreakdown?.style.ratingFillWidth < 60 && state.targetBreakdown?.state.isBICs,
    'sat-structureSetTargetPanel--viewingIndexOnBICSState': state.isViewingIndexOnBICS,
    'sat-structureSetTargetPanel--viewingClearTargetsState': state.isViewingClearTargets,
    'sat-structureSetTargetPanel--showSubPortfolioHighlightState': state.activeSubPortfolioFilter !== constants.subPortfolio.all
  }">
  <section class="sat-structureSetTargetPanel__utilities">
    <div class="sat-structureSetTargetPanel__utilities-setView">
      <button (click)="onToggleSetViewMode()" class="sat-structureSetTargetPanel__utilities-setView-btn">
        <i class="sat-structureSetTargetPanel__utilities-setView-btn-icon">
          <i class="sat-structureSetTargetPanel__utilities-setView-btn-icon--up fal fa-arrow-up"></i>
          <i class="sat-structureSetTargetPanel__utilities-setView-btn-icon--down fal fa-arrow-down"></i>
        </i>
        <span>Bulk Set View</span>
      </button>
    </div>
    <div class="sat-structureSetTargetPanel__utilities-distribution">
      <div class="sat-structureSetTargetPanel__utilities-distribution-label sat-structureSetTargetPanel__utilities-distribution-label--cs01">
        {{state.displayRemainingUnallocatedCS01}} ({{state.displayPercentageUnallocatedCS01}}%)
        <br>
        unallocated target
      </div>
      <div class="sat-structureSetTargetPanel__utilities-distribution-label sat-structureSetTargetPanel__utilities-distribution-label--creditLeverage">
        {{state.displayRemainingUnallocatedCreditLeverage}} ({{state.displayPercentageUnallocatedCreditLeverage}}%)
        <br>
        unallocated target
      </div>
      <div class="sat-structureSetTargetPanel__utilities-distribution-label sat-structureSetTargetPanel__utilities-distribution-label--distribute">
        Distribute Among All Unlocked
        <i class="sat-structureSetTargetPanel__utilities-distribution-label-icon fal fa-unlock-alt"></i>
        Rows :
      </div>
      <div class="sat-structureSetTargetPanel__utilities-distribution-ctas">
        <div class="sat-structureSetTargetPanel__utilities-distribution-ctas-btnContainer">
          <button (click)="onClickDistributeEvenly()" class="sat-structureSetTargetPanel__utilities-distribution-ctas-btnContainer-btn sat-structureSetTargetPanel__utilities-distribution-ctas-btnContainer-btn--evenly">Evenly</button>
          <button (click)="onClickDistributeProportionally()" class="sat-structureSetTargetPanel__utilities-distribution-ctas-btnContainer-btn sat-structureSetTargetPanel__utilities-distribution-ctas-btnContainer-btn--proportionally">Proportionally</button>
        </div>
        <span class="sat-structureSetTargetPanel__utilities-distribution-ctas-text">{{ state.distributeUtilityText }}</span>
      </div>
    </div>
    <div class="sat-structureSetTargetPanel__utilities-clearAll">
      <button (click)="onClickClearAllTargets()" class="sat-structureSetTargetPanel__utilities-clearAll-btn">
        <i class="sat-structureSetTargetPanel__utilities-clearAll-btn-icon fal fa-eraser"></i>
        Clear All Targets
      </button>
    </div>
  </section>
  <section class="sat-structureSetTargetPanel__main">
    <div class="sat-structureSetTargetPanel__main-clearTargets">
      <div class="sat-structureSetTargetPanel__main-clearTargets-header">
        <i class="sat-structureSetTargetPanel__main-clearTargets-header-icon fal fa-exclamation-triangle"></i>
        <p class="sat-structureSetTargetPanel__main-clearTargets-header-text">Clear All Targets</p>
      </div>
      <div class="sat-structureSetTargetPanel__main-clearTargets-options" *ngIf="state.clearTargetsOptionsList.length > 0">
        <p class="sat-structureSetTargetPanel__main-clearTargets-options-text">Select options to clear:</p>
        <ul class="sat-structureSetTargetPanel__main-clearTargets-options-list">
          <li class="sat-structureSetTargetPanel__main-clearTargets-options-list-item" *ngFor="let option of state.clearTargetsOptionsList">
            <button
              [ngClass]="{
              'sat-structureSetTargetPanel__main-clearTargets-options-list-item-btn': true,
              'sat-structureSetTargetPanel__main-clearTargets-options-list-item-btn--selected': option.isSelected
              }"
              (click)="onSelectClearAllOptions(option.backendIdentifier)">
              {{ option.key }}
            </button>
          </li>
        </ul>
      </div>
      <div class="sat-structureSetTargetPanel__main-clearTargets-text">
        <p class="sat-structureSetTargetPanel__main-clearTargets-text-description">By clicking save, {{ state.clearTargetsOptionsList.length > 0 ? 'selected' : 'all' }} {{ state.targetBreakdown?.data.title}} targets in {{ state.targetFund?.data.portfolioShortName}} (Sub-Portfolio: {{ state.activeSubPortfolioFilter }}) will be cleared</p>
        <p class="sat-structureSetTargetPanel__main-clearTargets-text-warning"><span class="sat-structureSetTargetPanel__main-clearTargets-text-warning-keyTerm">Warning:</span> This action cannot be undone</p>
      </div>
    </div>
    <div class="sat-structureSetTargetPanel__main-setTargets">
      <div class="sat-structureSetTargetPanel__main-setTargets-preview">
        <portfolio-breakdown
          *ngIf="state.targetBreakdown"
          [breakdownData]="state.targetBreakdown"
          [dataIsReady]="true">
        </portfolio-breakdown>
      </div>
      <div class="sat-structureSetTargetPanel__main-setTargets-configurator">
        <div class="sat-structureSetTargetPanel__main-setTargets-configurator-content">
          <security-definition-configurator
            [configuratorData]="state.configurator.dto"
            (clickedApplyFilter)="onApplyConfiguratorFilter($event)"
          ></security-definition-configurator>
        </div>
      </div>
      <div class="sat-structureSetTargetPanel__main-setTargets-edit">
        <div class="sat-structureSetTargetPanel__main-setTargets-edit-content">
          <div *ngIf="state.targetFund" class="sat-structureSetTargetPanel__main-setTargets-edit-content-header">
            <div class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-rating">
              <div
                class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-rating-fill"
                [ngStyle]="{
                  'width': state.targetBreakdown?.style.ratingFillWidth + '%'
                }">
              </div>
            </div>
            <div class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-categories">
              <div class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-categories-index">
                <span class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-categories-index-text">{{state.targetBreakdown?.data.indexName}}</span>
              </div>
              <div class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-categories-subPortfolio">
                <span class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-categories-subPortfolio-text">
                  <i class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-categories-subPortfolio-icon fal fa-chess"></i>
                  {{state.activeSubPortfolioFilter ? state.activeSubPortfolioFilter : '' }}
                </span>
              </div>
              <div class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-categories-cellsContainer">
                <div class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-categories-cellsContainer-cell">
                  <i class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-categories-cellsContainer-cell-icon fas fa-flag-checkered"></i>
                  <div class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-categories-cellsContainer-cell-tooltip">Target</div>
                </div>
                <div class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-categories-cellsContainer-cell">
                  <i class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-categories-cellsContainer-cell-icon fas fa-chart-pie"></i>
                  <div class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-categories-cellsContainer-cell-tooltip">Current %</div>
                </div>
                <div class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-categories-cellsContainer-cell sat-structureSetTargetPanel__main-setTargets-edit-content-header-categories-cellsContainer-cell--delta">
                  <i class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-categories-cellsContainer-cell-icon fal fa-triangle"></i>
                  <div class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-categories-cellsContainer-cell-tooltip">Delta %</div>
                </div>
                <div class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-categories-cellsContainer-cell sat-structureSetTargetPanel__main-setTargets-edit-content-header-categories-cellsContainer-cell--index">
                  <i class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-categories-cellsContainer-cell-icon fas fa-analytics"></i>
                  <div class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-categories-cellsContainer-cell-tooltip">Index %</div>
                </div>
              </div>
            </div>
            <button (click)="onClickNewOverrideRow()" class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-createRow santaBtn--labelled santaBtn--inverseLabelled">
              <i class="fal fa-plus"></i>
              <span>New Override Row</span>
            </button>
            <div class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-item">
              <button
                (click)="onClickChangeActiveMetric(constants.metric.creditLeverage)"
                [ngClass]="{
                  'santaBtn--labelled': true,
                  'sat-structureSetTargetPanel__main-setTargets-edit-content-header-item-btn': true,
                  'sat-structureSetTargetPanel__main-setTargets-edit-content-header-item-btn--selected': state.activeMetric === constants.metric.creditLeverage
                }">
                <i
                  [ngClass]="{
                    'fal': true,
                    'fa-check-square': state.activeMetric === constants.metric.creditLeverage,
                    'fa-square': state.activeMetric !== constants.metric.creditLeverage
                  }">
                </i>
                <span>{{state.displayCreditLeverageBtnText}}</span>
              </button>
              <target-bar [targetBar]="state.targetFund.data.creditLeverageTargetBar"></target-bar>
            </div>
            <div class="sat-structureSetTargetPanel__main-setTargets-edit-content-header-item">
              <button
                (click)="onClickChangeActiveMetric(constants.metric.cs01)"
                [ngClass]="{
                  'santaBtn--labelled': true,
                  'sat-structureSetTargetPanel__main-setTargets-edit-content-header-item-btn': true,
                  'sat-structureSetTargetPanel__main-setTargets-edit-content-header-item-btn--selected': state.activeMetric === constants.metric.cs01
                }">
                <i
                  [ngClass]="{
                    'fal': true,
                    'fa-check-square': state.activeMetric === constants.metric.cs01,
                    'fa-square': state.activeMetric !== constants.metric.cs01
                  }">
                </i>
                <span>{{state.displayCs01BtnText}}</span>
              </button>
              <target-bar [targetBar]="state.targetFund.data.cs01TargetBar"></target-bar>
            </div>
          </div>
          <ul class="sat-structureSetTargetPanel__main-setTargets-edit-content-rowList">
            <li
              *ngFor="let eachCategory of state.editRowList; let categoryIndex = index;"
              [ngClass]="{
                'sat-structureSetTargetEditRow': true,
                'sat-structureSetTargetEditRow--focusedCs01LevelState': eachCategory.targetCs01.level.isFocused,
                'sat-structureSetTargetEditRow--focusedCs01PercentState': eachCategory.targetCs01.percent.isFocused,
                'sat-structureSetTargetEditRow--focusedCreditLeverageLevelState': eachCategory.targetCreditLeverage.level.isFocused,
                'sat-structureSetTargetEditRow--focusedCreditLeveragePercentState': eachCategory.targetCreditLeverage.percent.isFocused,
                'sat-structureSetTargetEditRow--evenState': eachCategory.isEven,
                'sat-structureSetTargetEditRow--lockedState': eachCategory.isLocked,
                'sat-structureSetTargetEditRow--overrideVariant': state.targetBreakdownIsOverride,
                'sat-structureSetTargetEditRow--bicsBreakdownVariant': state.targetBreakdown?.state.isBICs,
                'sat-structureSetTargetEditRow--bicsLevel2Row': state.targetBreakdown?.state.isBICs && eachCategory.rowDTO.data.bicsLevel === 2,
                'sat-structureSetTargetEditRow--bicsLevel3Row': state.targetBreakdown?.state.isBICs && eachCategory.rowDTO.data.bicsLevel === 3,
                'sat-structureSetTargetEditRow--bicsLevel4PlusRow': state.targetBreakdown?.state.isBICs && eachCategory.rowDTO.data.bicsLevel >= 4,
                'sat-structureSetTargetEditRow--visibleState': eachCategory.isVisible,
                'sat-structureSetTargetEditRow--editingViewState': state.editViewMode,
                'sat-structureSetTargetEditRow--hasUpdatedViewState': eachCategory.isViewEdited,
                'sat-structureSetTargetEditRow--selectedPositiveView': eachCategory.view === constants.view.positive,
                'sat-structureSetTargetEditRow--selectedImprovingView': eachCategory.view === constants.view.improving,
                'sat-structureSetTargetEditRow--selectedDeterioratingView': eachCategory.view === constants.view.deteriorating,
                'sat-structureSetTargetEditRow--selectedNegativeView': eachCategory.view === constants.view.negative,
                'sat-structureSetTargetEditRow--selectedNeutralView': eachCategory.view === constants.view.neutral
              }">
              <section class="sat-structureSetTargetEditRow__setView">
                <button (click)="onClickSetView(eachCategory, constants.view.positive)"class="sat-structureSetTargetEditRow__setView-btn santaBtn--circleLabelled santaBtn--small sat-structureSetTargetEditRow__setView-btn--positive">
                  <i class="fal fa-arrow-up sat-structureSetTargetEditRow__setView-btn-icon"></i>
                  <span class="sat-structureSetTargetEditRow__setView-btn-text">{{ constants.view.positive }}</span>
                </button>
                <button (click)="onClickSetView(eachCategory, constants.view.improving)"class="sat-structureSetTargetEditRow__setView-btn santaBtn--circleLabelled santaBtn--small sat-structureSetTargetEditRow__setView-btn--improving">
                  <i class="fal fa-arrow-up sat-structureSetTargetEditRow__setView-btn-icon"></i>
                  <span class="sat-structureSetTargetEditRow__setView-btn-text">{{ constants.view.improving }}</span>
                </button>
                <button (click)="onClickSetView(eachCategory, constants.view.neutral)"class="sat-structureSetTargetEditRow__setView-btn santaBtn--circleLabelled santaBtn--small sat-structureSetTargetEditRow__setView-btn--neutral">
                  <i class="fal fa-arrows-alt-h sat-structureSetTargetEditRow__setView-btn-icon"></i>
                  <span class="sat-structureSetTargetEditRow__setView-btn-text">{{ constants.view.neutral }}</span>
                </button>
                <button (click)="onClickSetView(eachCategory, constants.view.deteriorating)"class="sat-structureSetTargetEditRow__setView-btn santaBtn--circleLabelled santaBtn--small sat-structureSetTargetEditRow__setView-btn--deteriorating">
                  <i class="fal fa-arrow-down sat-structureSetTargetEditRow__setView-btn-icon"></i>
                  <span class="sat-structureSetTargetEditRow__setView-btn-text">{{ constants.view.deteriorating }}</span>
                </button>
                <button (click)="onClickSetView(eachCategory, constants.view.negative)"class="sat-structureSetTargetEditRow__setView-btn santaBtn--circleLabelled santaBtn--small sat-structureSetTargetEditRow__setView-btn--negative">
                  <i class="fal fa-arrow-down sat-structureSetTargetEditRow__setView-btn-icon"></i>
                  <span class="sat-structureSetTargetEditRow__setView-btn-text">{{ constants.view.negative }}</span>
                </button>
              </section>
              <section class="sat-structureSetTargetEditRow__details">
                <portfolio-breakdown-row
                  *ngIf="eachCategory.rowDTO"
                  [breakdownRow]="eachCategory.rowDTO"
                  (categoryClicked)="onClickEditCategory($event)"
                  (rowDiveInClicked)="getSubLevelEditRows($event)"
                  >
                </portfolio-breakdown-row>
              </section>
              <section class="sat-structureSetTargetEditRow__remove">
                <button (click)="onSelectForRemoval(eachCategory)" class="sat-structureSetTargetEditRow__remove-btn santaBtn--iconOnly fal fa-times"></button>
              </section>
              <section class="sat-structureSetTargetEditRow__lock">
                <button
                  (click)="onToggleLock(eachCategory)"
                  [ngClass]="{
                    'sat-structureSetTargetEditRow__lock-btn': true,
                    'santaBtn--iconOnly': true,
                    'fal fa-unlock-alt': !eachCategory.isLocked,
                    'fas fa-lock-alt': eachCategory.isLocked
                  }">
                </button>
              </section>
              <section class="sat-structureSetTargetEditRow__clearTarget">
                <button
                (click)="onClearRowTarget(eachCategory)"
                class="sat-structureSetTargetEditRow__clearTarget-btn santaBtn--iconOnly fal fa-eraser">
              </button>
              </section>
              <section class="sat-structureSetTargetEditRow__label">
                <span class="sat-structureSetTargetEditRow__label-text">{{eachCategory.displayRowTitle}}</span>
                <santa-textarea
                  class="sat-structureSetTargetEditRow__label-input"
                  [inputValue]="eachCategory.displayRowTitle"
                  (onInputChange)="onEditRowRenamed($event, eachCategory)"
                  >
                </santa-textarea>
              </section>
              <section class="sat-structureSetTargetEditRow__column sat-structureSetTargetEditRow__column--creditLeverage">
                <div class="sat-structureSetTargetEditRow__column-item sat-structureSetTargetEditRow__column-item--creditLeverageLevel">
                  <div class="sat-structureSetTargetEditRow__column-item-ctas">
                    <button *ngIf="eachCategory.targetCreditLeverage.level.isFocused" (click)="onClickSaveEdit(eachCategory, eachCategory.targetCreditLeverage.level)" class="santaBtn--small santaBtn--iconOnly sat-structureSetTargetEditRow__column-item-ctas-save fal fa-check"></button>
                  </div>
                  <santa-input
                    [inputValue]="eachCategory.targetCreditLeverage.level.savedDisplayValue"
                    [placeholder]="''"
                    [isNumeric]="true"
                    [isGrayedOut]="true"
                    [isDisabled]="true"
                    [isNonEditable]="true"
                    (onInputChange)="onValueChange($event, eachCategory.targetCreditLeverage.level)"
                    (onEnterKeyPressed)="onPressedEnterKeyInInput(eachCategory, eachCategory.targetCreditLeverage.level)">
                  </santa-input>
                  <span class="sat-structureSetTargetEditRow__column-item-unitText"></span>
                </div>
                <div class="sat-structureSetTargetEditRow__column-item sat-structureSetTargetEditRow__column-item--creditLeveragePercent">
                  <div class="sat-structureSetTargetEditRow__column-item-ctas">
                    <button *ngIf="eachCategory.targetCreditLeverage.percent.isFocused" (click)="onClickSaveEdit(eachCategory, eachCategory.targetCreditLeverage.percent)" class="santaBtn--small santaBtn--iconOnly sat-structureSetTargetEditRow__column-item-ctas-save fal fa-check"></button>
                  </div>
                  <santa-input
                    [inputValue]="eachCategory.targetCreditLeverage.percent.savedDisplayValue"
                    [placeholder]="''"
                    [isNumeric]="true"
                    [isGrayedOut]="true"
                    [isDisabled]="true"
                    [isNonEditable]="true"
                    (onInputChange)="onValueChange($event, eachCategory.targetCreditLeverage.percent)"
                    (onEnterKeyPressed)="onPressedEnterKeyInInput(eachCategory, eachCategory.targetCreditLeverage.percent)">
                  </santa-input>
                  <span class="sat-structureSetTargetEditRow__column-item-unitText">%</span>
                </div>
              </section>
              <section class="sat-structureSetTargetEditRow__column sat-structureSetTargetEditRow__column--cs01">
                <div class="sat-structureSetTargetEditRow__column-item sat-structureSetTargetEditRow__column-item--cs01Level">
                  <div class="sat-structureSetTargetEditRow__column-item-ctas">
                    <button *ngIf="eachCategory.targetCs01.level.isFocused" (click)="onClickSaveEdit(eachCategory, eachCategory.targetCs01.level)" class="santaBtn--small santaBtn--iconOnly sat-structureSetTargetEditRow__column-item-ctas-save fal fa-check"></button>
                  </div>
                  <santa-input
                    [inputValue]="eachCategory.targetCs01.level.savedDisplayValue"
                    [placeholder]="''"
                    [isNumeric]="true"
                    [isGrayedOut]="state.activeMetric !== constants.metric.cs01"
                    [isDisabled]="state.activeMetric !== constants.metric.cs01"
                    (onInputChange)="onValueChange($event, eachCategory.targetCs01.level)"
                    (onEnterKeyPressed)="onPressedEnterKeyInInput(eachCategory, eachCategory.targetCs01.level)">
                  </santa-input>
                  <span class="sat-structureSetTargetEditRow__column-item-unitText">K</span>
                </div>
                <div class="sat-structureSetTargetEditRow__column-item sat-structureSetTargetEditRow__column-item--cs01Percent">
                  <div class="sat-structureSetTargetEditRow__column-item-ctas">
                    <button *ngIf="eachCategory.targetCs01.percent.isFocused" (click)="onClickSaveEdit(eachCategory, eachCategory.targetCs01.percent)" class="santaBtn--small santaBtn--iconOnly sat-structureSetTargetEditRow__column-item-ctas-save fal fa-check"></button>
                  </div>
                  <santa-input
                    [inputValue]="eachCategory.targetCs01.percent.savedDisplayValue"
                    [placeholder]="''"
                    [isNumeric]="true"
                    [isGrayedOut]="state.activeMetric !== constants.metric.cs01"
                    [isDisabled]="state.activeMetric !== constants.metric.cs01"
                    (onInputChange)="onValueChange($event, eachCategory.targetCs01.percent)"
                    (onEnterKeyPressed)="onPressedEnterKeyInInput(eachCategory, eachCategory.targetCs01.percent)">
                  </santa-input>
                  <span class="sat-structureSetTargetEditRow__column-item-unitText">%</span>
                </div>
              </section>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </section>
</article>